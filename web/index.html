<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üß† Smart Inventory & Expiry Tracker</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #2c3e50;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .container {
      max-width: 950px;
      background-color: #fff;
      margin: 40px auto;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2c3e50;
      margin-bottom: 15px;
      border-left: 4px solid #3498db;
      padding-left: 10px;
    }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; color: #333; }
    input, select {
      width: 100%; padding: 10px; border: 1px solid #ccc;
      border-radius: 6px; font-size: 15px;
    }
    button {
      background-color: #3498db;
      color: white; border: none;
      padding: 10px 18px; border-radius: 6px;
      font-size: 15px; cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover { background-color: #2980b9; }
    .refresh-btn { background-color: #2ecc71; }
    .refresh-btn:hover { background-color: #27ae60; }
    .delete-btn {
      background-color: #e74c3c;
      border: none; color: white;
      padding: 8px 12px; border-radius: 6px;
      cursor: pointer; transition: 0.3s;
    }
    .delete-btn:hover { background-color: #c0392b; }
    table {
      width: 100%; border-collapse: collapse;
      margin-top: 20px; border-radius: 8px;
      overflow: hidden;
    }
    th, td { padding: 12px; border: 1px solid #ddd; text-align: center; }
    th { background-color: #3498db; color: white; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    hr { margin: 30px 0; border: 0; border-top: 1px solid #ddd; }
    .center { text-align: center; margin-top: 20px; }
    footer {
      text-align: center;
      padding: 15px;
      background-color: #2c3e50;
      color: white;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <header>üß† Smart Inventory & Expiry Tracker</header>

  <div class="container">
    <!-- Add Product -->
    <h2>Add New Product</h2>
    <div id="form">
      <div class="form-group">
        <label>Product Name:</label>
        <input id="name" type="text" placeholder="Enter product name" />
      </div>
      <div class="form-group">
        <label>Category:</label>
        <input id="category" type="text" placeholder="e.g. Dairy, Bakery" />
      </div>
      <div class="form-group">
        <label>Quantity:</label>
        <input id="quantity" type="number" placeholder="Enter quantity" />
      </div>
      <div class="form-group">
        <label>Price:</label>
        <input id="price" type="number" step="0.01" placeholder="Enter price" />
      </div>
      <div class="form-group">
        <label>Manufacture Date:</label>
        <input id="mfg" type="date" />
      </div>
      <div class="form-group">
        <label>Expiry Date:</label>
        <input id="exp" type="date" />
      </div>
      <div class="form-group">
        <label>Supplier:</label>
        <input id="supplier" type="text" placeholder="Enter supplier name" />
      </div>
      <div class="center">
        <button onclick="addProduct()">Add Product</button>
      </div>
    </div>

    <hr>

    <!-- View Products -->
    <h2>üì¶ Product List</h2>
    <div class="center">
      <button class="refresh-btn" onclick="loadProducts()">Refresh Products</button>
    </div>

    <table id="productTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Expiry</th>
          <th>Supplier</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <hr>

    <!-- Expiry Alerts -->
    <h2>‚ö†Ô∏è Expiry Alerts</h2>
    <div class="form-group">
      <label>Select Category:</label>
      <select id="categorySelect">
  <option value="All">All</option>
  <option value="Dairy">Dairy</option>
  <option value="Bakery">Bakery</option>
  <option value="Beverages">Beverages</option>
  <option value="Personal Care">Personal Care</option>
</select>

    </div>
    <div class="center">
      <button class="refresh-btn" onclick="loadExpiryAlerts()">View Expiring Soon</button>
    </div>

    <table id="expiryTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Category</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Expiry Date</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <footer>¬© 2025 Smart Inventory Tracker | Developed by Tanuja Koranga</footer>

  <script>
    // Load all products
    async function loadProducts() {
      const res = await fetch('http://localhost:8080/viewProducts');
      const data = await res.json();
      const tbody = document.querySelector('#productTable tbody');
      tbody.innerHTML = '';
      data.forEach(p => {
        const row = `<tr>
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.quantity}</td>
          <td>${p.price}</td>
          <td>${p.expiry_date}</td>
          <td>${p.supplier}</td>
          <td><button class="delete-btn" onclick="deleteProduct(${p.id})">üóëÔ∏è Delete</button></td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    // Add Product
    async function addProduct() {
      const product = {
        product_name: document.getElementById('name').value,
        category: document.getElementById('category').value,
        quantity: document.getElementById('quantity').value,
        price: document.getElementById('price').value,
        manufacture_date: document.getElementById('mfg').value,
        expiry_date: document.getElementById('exp').value,
        supplier: document.getElementById('supplier').value
      };
      const res = await fetch('http://localhost:8080/addProduct', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
      const data = await res.json();
      alert(data.success ? '‚úÖ Product added successfully!' : '‚ùå Error: ' + data.error);
      loadProducts();
    }

    // Delete Product
    // Delete Product
async function deleteProduct(id) {
  if (!confirm('Are you sure you want to delete this product?')) return;

  const res = await fetch(`http://localhost:8080/deleteProduct?id=${id}`, {
    method: "POST"   // ‚úî MUST be POST
  });

  const data = await res.json();

  if (data.success) {
    alert('üóëÔ∏è Product deleted!');
    loadProducts(); // ‚úî Refresh UI
  } else {
    alert("‚ùå Error: " + (data.message || data.error));
  }
}


    // Expiry Alerts
    async function loadExpiryAlerts() {
  const category = document.getElementById('categorySelect').value;

  const url = category === "All"
    ? `http://localhost:8080/expiryAlerts`
    : `http://localhost:8080/expiryAlerts?category=${category}`;

  const res = await fetch(url);
  const data = await res.json();

  const tbody = document.querySelector('#expiryTable tbody');
  tbody.innerHTML = '';

  if (data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="6">No expiring products found in ${category} üòÑ</td></tr>`;
    return;
  }

  data.forEach(p => {
    const row = `<tr>
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>${p.quantity}</td>
      <td>${p.price}</td>
      <td>${p.expiry_date}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}


    window.onload = loadProducts;
  </script>
</body>
</html>
